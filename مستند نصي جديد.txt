تنفيذ المرحلة الأولى: بناء الهيكل والنمذجة الذكية لـ ZeroHour Studio V2
أريد منك تأسيس الحل (Solution) باستخدام.NET 8 بهذه المواصفات:

أنشئ 4 مشاريع (Domain, Application, Infrastructure, UI.WPF) مع ضبط المراجع (Project References) بحيث تتبع Clean Architecture (الخارج يشير للداخل).

داخل مشروع Domain، أنشئ المجلد 'Entities' وأضف الكلاسات التالية:

'SageUnit': يحتوي على (TechnicalName, Side, BuildCost, WeaponSet, ModelW3D).

'SageFaction': يحتوي على (InternalName, DisplayName, CommandSetPath).

'DependencyNode': كلاس مسؤول عن ربط الوحدة بملفات (DDS, W3D, Audio).

حل مشكلة البحث (Normalization): داخل Domain، أنشئ 'ValueObject' باسم 'FactionName'. يجب أن يحتوي على منطق يقوم تلقائياً بـ:

إزالة المسافات (Strip Spaces).

تحويل الأحرف لصغيرة (ToLower).

إضافة بادئة 'Faction' إذا لم تكن موجودة. (هذا سيحل مشكلة فشل البحث عن 'China Nuke General' التي ظهرت في سجلاتنا السابقة).

داخل Application، أنشئ 'Interfaces' لكل من:

'IBigFileReader': لفتح أرشيفات اللعبة.

'IIniParser': لتحليل كود الـ INI.

أريدك أن تبني محرك القراءة العميق داخل مشروع ZeroHourStudio.Infrastructure باتباع هذه القواعد التقنية:

1. برمجة BigArchiveManager:

استخدم BinaryReader و MemoryMappedFile لقراءة ملفات الـ BIG الأصلية بأداء عالٍ. [cite: 41, 45]

قم ببرمجة نظام "الأولوية" (Mounting Priority)؛ حيث يتم ترتيب الملفات التي تبدأ بـ !! لتكون هي التي "تُربح" عند وجود تعارض في أسماء الملفات الداخلية. [cite: 1, 7]

2. برمجة SAGE_IniParser المطور:

استخدم ReadOnlySpan<char> لمسح الأسطر. [cite: 34]

يجب أن يكون المحلل غير حساس لحالة الأحرف (Case-Insensitive) ويتجاهل التعليقات التي تبدأ بـ ;. [cite: 6, 103]

صمم دالة ExtractObject(string technicalName) لجمع كود الوحدة كاملاً من أول سطر Object حتى سطر End.

3. تفعيل نظام SmartNormalization (حل مشكلة البحث):

داخل طبقة الـ Infrastructure، قم بتنفيذ دالة تقوم بمعالجة أي اسم فصيل يدخله المستخدم:

إذا أدخل "China Nuke General"، حوله برمجياً إلى "FactionChinaNukeGeneral".

استخدم خوارزمية "Fuzzy Matching" بسيطة لربط الكلمات المتقاربة بمعرفات الفصائل العشرة المكتشفة في سجلاتنا. [cite: 1, 21]

4. ربط الـ Interfaces:

تأكد أن الكلاسات في Infrastructure تنفذ الـ Interfaces التي أنشأناها في طبقة الـ Application (مثل IBigFileReader و IIniParser).

أريدك أن تبني "نظام التتبع الذكي" داخل طبقتي الـ Application والـ Infrastructure باتباع الآتي:

1. برمجة UnitDependencyAnalyzer:

صمم خوارزمية تقوم ببناء "رسم بياني" (Graph) لكل وحدة يتم اختيارها.

يجب أن تتتبع السلسلة التالية تلقائياً: Object INI -> Armor.ini -> Weapon.ini -> Projectile.ini -> FXList.ini -> Audio.ini. [cite: 6, 7]

استخدم دالة عودية (Recursive Function) لضمان جمع كافة المستويات من التبعات.

2. برمجة AssetReferenceHunter:

وظيفتها البحث عن المراجع الخارجية:

البحث عن ملفات الـ 3D Models (امتداد .w3d). [cite: 1, 4]

البحث عن ملفات الـ Textures (امتداد .dds أو .tga). [cite: 16, 73]

البحث عن ملفات الـ Audio (امتداد .wav أو .mp3). [cite: 1, 13]

يجب أن تتحقق الدالة من وجود هذه الملفات داخل الفهرس (Index) الذي أنشأناه في المرحلة الثانية.

3. بناء TransferValidationService:

دالة تقوم بفحص "اكتمال" الوحدة:

إذا كانت الوحدة تفتقد لملف W3D، قم بوسمها بـ Incomplete.

تأكد من أن الـ CommandSet المرتبط بالوحدة موجود فعلياً في ملفات الـ INI المستهدفة. [cite: 1, 13]

4. الربط البرمجي:

تأكد من استخدام الـ Services التي برمجناها في المرحلة الثانية (BigArchiveManager, SAGE_IniParser) لجمع هذه البيانات.

حان الوقت لتحويل المنطق البرمجي إلى واجهة مستخدم احترافية بنمط MVVM داخل مشروع ZeroHourStudio.UI.WPF. اتبع التعليمات التالية:

1. هندسة الـ ViewModels:

أنشئ MainViewModel ليكون العقل المدبر للواجهة.

استخدم ObservableCollection لعرض الوحدات المكتشفة لضمان التحديث اللحظي للواجهة.

برمج دالة async Task LoadModAsync() التي تستخدم الـ Services من Infrastructure لفهرسة الملفات دون تجميد شاشة المستخدم [cite: 34, 49].

2. تصميم الواجهة (XAML):

خانة البحث (SearchBox): اربطها بدالة الـ SmartNormalization. يجب أن تقدم اقتراحات (Auto-complete) لأسماء الفصائل الصحيحة برمجياً (مثل تحويل Nuke إلى FactionChinaNukeGeneral) [cite: 1, 14].

شجرة التبعات (Dependency TreeView): صمم جزءاً في الواجهة يعرض نتائج UnitDependencyAnalyzer؛ أريد أن يرى المستخدم ملفات الـ W3D والأصوات المرتبطة بالدبابة قبل أن يضغط على "نقل".

مؤشر الحالة (Progress Ring): أظهر مؤشر تحميل أثناء مسح الـ 35,326 عنصراً المكتشفة في السجلات.

3. نظام "تنبيهات السلامة" (Safety Notifications):

إذا وجد نظام TransferValidationService (من المرحلة الثالثة) أن الوحدة ناقصة، قم بتلوينها باللون الأحمر في القائمة وأظهر رسالة تحذير تشرح الملفات المفقودة [cite: 1, 37].

4. تفعيل "زر النقل الذكي":

عند الضغط على "نقل"، قم باستدعاء TransferUnitUseCase من طبقة الـ Application لضمان تنفيذ العملية "الذرية" (نقل كل شيء أو لا شيء) لضمان سلامة المود الهدف.