# خارطة تطوير ZeroHour Studio - حسب فكرة البرنامج

## الفكرة الأساسية

1. **تحميل أي مود** (مثل جنرال زيرو آور) واستخراج **الأسلحة** و**الفصائل** مع كل أسلحتها
2. **عند اختيار المود الهدف** → يستعرض الأسلحة ويستعرض الفصائل التابعة لها
3. **عند النقل** → المستخدم يختار **الفصيل الهدف** الذي يريد إضافة السلاح إليه
4. **البرنامج يحدد تلقائياً**: الأزرار، الطوابع (Cameos)، CommandSet كاملة

---

## الوضع الحالي vs المطلوب

| الميزة | الحالي | المطلوب |
|--------|--------|---------|
| عرض الوحدات | قائمة مسطحة | تجميع حسب الفصيل: فصيل → أسلحة/وحدات |
| عرض المود الهدف | مسار فقط | استعراض فصائل وأسلحة المود الهدف |
| اختيار الفصيل عند النقل | يستخدم Side من المصدر تلقائياً | المستخدم يختار الفصيل الهدف يدوياً |
| الطوابع (Cameos) | CommandButton بدون ButtonImage | نسخ/إنشاء ButtonImage من المصدر |
| عرض العلاقات | شجرة التبعيات فقط | السلاح → الفصائل التي يستخدمه → الأزرار |

---

## خطة التطوير المقترحة

### المرحلة 1: عرض مجمّع بالفصائل (أولوية عالية)
- **تجميع الوحدات حسب Side (الفصيل)** في الواجهة
- عرض: `USA → [AmericaTankCrusader, ...]` و `China → [OverlordTank, ...]`
- فلتر حسب الفصيل عند البحث
- **الملفات:** MainWindow.xaml, MainViewModel, UnitDiscoveryService

### المرحلة 2: استكشاف المود الهدف (أولوية عالية)
- عند اختيار مسار المود الهدف: **مسح فصائله ووحداته**
- عرض قائمة الفصائل الموجودة في المود الهدف
- عرض "ما تم نقله مسبقاً" vs "ما سينقل"
- **خدمة جديدة:** `TargetModDiscoveryService`

### المرحلة 3: اختيار الفصيل عند النقل (أولوية حرجة)
- قبل النقل: **نافذة/قائمة لاختيار الفصيل الهدف**
- الخيارات: الفصائل المكتشفة في المود الهدف (USA, China, GLA, إلخ)
- عند النقل: استخدام الفصيل المختار بدل Side المصدر
- **تعديل:** CommandSetPatchService.ResolveFactoryCommandSet يأخذ الفصيل المختار

### المرحلة 4: الطوابع والأيقونات (أولوية متوسطة)
- نسخ `ButtonImage` و `SelectPortrait` من وحدة المصدر إن وُجدت
- إنشاء الطوابع في CommandButton المنشأ
- البحث في MappedImages.ini وأرشفة الصور
- **تعديل:** CommandSetPatchService.AppendCommandButtonAsync

### المرحلة 5: واجهة استعراض محسّنة (أولوية متوسطة)
- تبويبات: المصدر | الهدف | التبعيات
- معاينة الملفات قبل النقل (Preview)
- تصدير تقرير بالملفات المنقولة

---

## ملخص التنفيذ السريع

**تم تنفيذها:**
1. ✅ تجميع القائمة بالفصائل (Grouping by Side)
2. ✅ اكتشاف فصائل المود الهدف عند اختيار المسار
3. ✅ قائمة منسدلة لاختيار الفصيل الهدف قبل زر "نقل الوحدة"
4. ✅ تمرير الفصيل المختار إلى CommandSetPatchService

---

## ملاحظات تقنية

- **Side** في SageUnit = الفصيل (USA, China, GLA, etc.)
- **CommandSet** مرتبط بالفصيل عبر مصانع الحرب (WarFactory)
- **CommandSetPatchService** يستخدم `ResolveFactoryCommandSet(unit.Side)` - يحتاج أن يقبل فصيلاً معياراً
- الفصائل المعروفة: usa, chinanuke, chinainf, glainf, glalair, glatet, superweapon, kingraptor, tower, skirmish
