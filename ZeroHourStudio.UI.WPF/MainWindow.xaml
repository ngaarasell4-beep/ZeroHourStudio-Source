<Window x:Class="ZeroHourStudio.UI.WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ZeroHourStudio.UI.WPF"
        xmlns:viewmodels="clr-namespace:ZeroHourStudio.UI.WPF.ViewModels"
        xmlns:conv="clr-namespace:ZeroHourStudio.UI.WPF.Converters"
        mc:Ignorable="d"
        Title="ZeroHour Studio V2" 
        Height="750" Width="1100"
        Background="#1E1E1E"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        <conv:ButtonImageToIconConverter x:Key="IconConverter"/>
        <conv:SeverityColorConverter x:Key="SeverityColorConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#2D2D2D" Padding="15" BorderThickness="0,0,0,1" BorderBrush="#3F3F3F">
            <Grid>
                <TextBlock Text="Zero Hour Studio V2" FontSize="20" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <TextBox Width="250" Height="30" VerticalContentAlignment="Center" Padding="8,0"
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                              Background="#333333" Foreground="White" BorderBrush="#444444"
                              AutomationProperties.Name="Ø¨Ø­Ø« Ø§Ù„ÙˆØ­Ø¯Ø§Øª" AutomationProperties.AutomationId="SearchBox"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Paths -->
        <Border Grid.Row="1" Background="#252525" Padding="12,8" BorderThickness="0,0,0,1" BorderBrush="#3F3F3F">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Row="0" Grid.Column="0" Text="Ø§Ù„Ù…ØµØ¯Ø±:" Foreground="#AAAAAA" VerticalAlignment="Center" Margin="0,0,8,4" FontSize="12"/>
                <TextBox Grid.Row="0" Grid.Column="1" Height="28" VerticalContentAlignment="Center" Padding="8,0"
                         Text="{Binding SourceModPath, Mode=TwoWay}" Background="#333333" Foreground="White" BorderBrush="#444444" IsReadOnly="True" Margin="0,0,8,4"
                         AutomationProperties.Name="Ù…Ø³Ø§Ø± Ø§Ù„Ù…ÙˆØ¯ Ø§Ù„Ù…ØµØ¯Ø±" AutomationProperties.AutomationId="SourcePath"/>
                <Button Grid.Row="0" Grid.Column="2" Content="Ø§Ø³ØªØ¹Ø±Ø§Ø¶" Padding="15,3" Height="28" Background="#0078D4" Foreground="White" Margin="0,0,0,4" Click="BrowseSourcePath_Click"
                        AutomationProperties.Name="Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ù…Ø³Ø§Ø± Ø§Ù„Ù…ØµØ¯Ø±" AutomationProperties.AutomationId="BrowseSource"/>

                <TextBlock Grid.Row="1" Grid.Column="0" Text="Ø§Ù„Ù‡Ø¯Ù:" Foreground="#AAAAAA" VerticalAlignment="Center" Margin="0,0,8,0" FontSize="12"/>
                <TextBox Grid.Row="1" Grid.Column="1" Height="28" VerticalContentAlignment="Center" Padding="8,0"
                         Text="{Binding TargetModPath, Mode=TwoWay}" Background="#333333" Foreground="White" BorderBrush="#444444" IsReadOnly="True" Margin="0,0,8,0"
                         AutomationProperties.Name="Ù…Ø³Ø§Ø± Ø§Ù„Ù…ÙˆØ¯ Ø§Ù„Ù‡Ø¯Ù" AutomationProperties.AutomationId="TargetPath"/>
                <Button Grid.Row="1" Grid.Column="2" Content="Ø§Ø³ØªØ¹Ø±Ø§Ø¶" Padding="15,3" Height="28" Background="#0078D4" Foreground="White" Click="BrowseTargetPath_Click"
                        AutomationProperties.Name="Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ù…Ø³Ø§Ø± Ø§Ù„Ù‡Ø¯Ù" AutomationProperties.AutomationId="BrowseTarget"/>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="2" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="320"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT: Faction + Unit List -->
            <Border Grid.Column="0" Background="#2D2D2D" CornerRadius="5" Margin="0,0,8,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Faction Filter -->
                    <Border Grid.Row="0" Background="#333333" Padding="10" CornerRadius="5,5,0,0">
                        <StackPanel>
                            <TextBlock Text="Ø§Ø®ØªØ± Ø§Ù„ÙØµÙŠÙ„:" Foreground="#AAAAAA" FontSize="12" Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding Factions}" SelectedItem="{Binding SelectedFaction}"
                                      Height="30" VerticalContentAlignment="Center" FontSize="13"
                                      Background="#444444" Foreground="White" BorderBrush="#555555"
                                      AutomationProperties.Name="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØµÙŠÙ„" AutomationProperties.AutomationId="FactionFilter"/>
                        </StackPanel>
                    </Border>

                    <!-- Stats -->
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="10,8,10,5">
                        <TextBlock Text="Ø§Ù„ÙˆØ­Ø¯Ø§Øª: " Foreground="#888888" FontSize="11"/>
                        <TextBlock Text="{Binding DisplayedUnits.Count}" Foreground="#00CC66" FontSize="11" FontWeight="Bold"/>
                        <TextBlock Text=" / " Foreground="#555555" FontSize="11"/>
                        <TextBlock Text="{Binding Units.Count}" Foreground="#888888" FontSize="11"/>
                    </StackPanel>

                    <!-- Unit List (simple, fast, virtualized) -->
                    <ListBox Grid.Row="2" ItemsSource="{Binding DisplayedUnits}" SelectedItem="{Binding SelectedUnit}"
                             Background="Transparent" BorderThickness="0" Foreground="White" Margin="5,0,5,5"
                             VirtualizingPanel.IsVirtualizing="True"
                             VirtualizingPanel.VirtualizationMode="Recycling"
                              ScrollViewer.IsDeferredScrollingEnabled="True"
                              ScrollViewer.CanContentScroll="True"
                              AutomationProperties.Name="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆØ­Ø¯Ø§Øª" AutomationProperties.AutomationId="UnitsList">
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="AutomationProperties.Name" Value="{Binding TechnicalName}"/>
                            </Style>
                        </ListBox.ItemContainerStyle>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="6,4" Margin="1" CornerRadius="3" Background="#3D3D3D">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Border Grid.Column="0" Width="40" Height="40" CornerRadius="3" Background="#2A2A2A" Margin="0,0,8,0">
                                            <Image Source="{Binding ButtonImage, Converter={StaticResource IconConverter}}" 
                                                   Stretch="Uniform" RenderOptions.BitmapScalingMode="HighQuality"/>
                                        </Border>
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding TechnicalName}" FontSize="12" FontWeight="SemiBold" TextTrimming="CharacterEllipsis" Foreground="White"/>
                                            <TextBlock Text="{Binding Side}" Foreground="#FF6B00" FontSize="10" Margin="0,2,0,0"/>
                                        </StackPanel>
                                        <TextBlock Grid.Column="2" Text="{Binding BuildCost}" Foreground="#00CC66" FontSize="10" VerticalAlignment="Center" Margin="5,0,0,0"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <!-- Load Button -->
                    <Button Grid.Row="3" Content="ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯" Margin="10" Padding="8"
                            Command="{Binding LoadModCommand}" Background="#FF6B00" Foreground="White" FontWeight="Bold"
                            IsEnabled="{Binding HasSourcePath}"
                            AutomationProperties.Name="ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯" AutomationProperties.AutomationId="LoadMod"/>
                </Grid>
            </Border>

            <!-- RIGHT: Details Panel -->
            <Border Grid.Column="1" Background="#2D2D2D" CornerRadius="5">
                <Grid Margin="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Unit Name -->
                    <TextBlock Grid.Row="0" Margin="0,0,0,10">
                        <Run Text="{Binding SelectedUnit.TechnicalName, TargetNullValue='Ø§Ø®ØªØ± ÙˆØ­Ø¯Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©', Mode=OneWay}" FontSize="18" FontWeight="Bold" Foreground="White"/>
                        <Run Text=" " />
                        <Run Text="{Binding SelectedUnit.Side, Mode=OneWay}" Foreground="#FF6B00" FontSize="14"/>
                    </TextBlock>

                    <!-- Stats Row -->
                    <Border Grid.Row="1" Padding="12" Background="#3D3D3D" CornerRadius="5" Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Foreground="#AAAAAA" FontSize="13">
                                <Run Text="Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª: "/><Run Text="{Binding TotalDependencyCount, Mode=OneWay}" Foreground="#0078D4" FontWeight="Bold"/>
                                <Run Text="  |  Ø§Ù„Ø£Ø³Ù„Ø­Ø©: "/><Run Text="{Binding WeaponAnalysisCount, Mode=OneWay}" Foreground="#FF6B00" FontWeight="Bold"/>
                                <Run Text="  |  Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©: "/><Run Text="{Binding CurrentGraph.MissingCount, TargetNullValue=0, Mode=OneWay}" Foreground="#FF4444" FontWeight="Bold"/>
                                <Run Text="  |  Ø§Ù„Ø­Ø§Ù„Ø©: "/><Run Text="{Binding CurrentGraph.Status, TargetNullValue=-, Mode=OneWay}" Foreground="#00CC66" FontWeight="Bold"/>
                            </TextBlock>
                            <TextBlock Text="  Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„..." Foreground="#FFD700" Visibility="{Binding IsAnalyzing, Converter={StaticResource BoolToVisibility}}" FontSize="12"/>
                        </StackPanel>
                    </Border>

                    <!-- Model Info -->
                    <Border Grid.Row="2" Padding="8" Background="#353535" CornerRadius="3" Margin="0,0,0,10">
                        <TextBlock Foreground="#999999" FontSize="11">
                            <Run Text="Ø§Ù„Ù†Ù…ÙˆØ°Ø¬: "/><Run Text="{Binding SelectedUnit.ModelW3D, TargetNullValue=-, Mode=OneWay}" Foreground="#CCCCCC"/>
                        </TextBlock>
                    </Border>

                    <!-- Tabs: Dependencies & Diagnostics -->
                    <TabControl Grid.Row="3" Background="Transparent" BorderThickness="0" Margin="0,0,0,10"
                                AutomationProperties.Name="ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª ÙˆØ§Ù„ØªØ´Ø®ÙŠØµ" AutomationProperties.AutomationId="MainTabs">
                        <TabControl.Resources>
                            <Style TargetType="TabItem">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="TabItem">
                                            <Border Name="Border" BorderThickness="0,0,0,2" BorderBrush="Transparent" Margin="0,0,10,0" Padding="10,5">
                                                <ContentPresenter x:Name="ContentSite" VerticalAlignment="Center" HorizontalAlignment="Center" ContentSource="Header" Margin="0,2"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter TargetName="Border" Property="BorderBrush" Value="#0078D4"/>
                                                    <Setter Property="Foreground" Value="#0078D4"/>
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                </Trigger>
                                                <Trigger Property="IsSelected" Value="False">
                                                    <Setter Property="Foreground" Value="#AAAAAA"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </TabControl.Resources>

                        <!-- Tab 1: Dependencies -->
                        <TabItem Header="Ø´Ø¬Ø±Ø© Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª" AutomationProperties.Name="ØªØ¨ÙˆÙŠØ¨ Ø´Ø¬Ø±Ø© Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª" AutomationProperties.AutomationId="DependenciesTab">
                            <DockPanel Margin="0,10,0,0">
                                <TreeView Background="#252525" Foreground="White" BorderBrush="#3F3F3F"
                                          ItemsSource="{Binding CurrentGraph.RootNode.Dependencies}"
                                          VirtualizingPanel.IsVirtualizing="True"
                                          AutomationProperties.Name="Ø´Ø¬Ø±Ø© Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª" AutomationProperties.AutomationId="DependenciesTree">
                                    <TreeView.ItemTemplate>
                                        <HierarchicalDataTemplate ItemsSource="{Binding Dependencies}">
                                            <StackPanel Orientation="Horizontal" Margin="2">
                                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="12"/>
                                                <TextBlock Text="{Binding Type, StringFormat=' [{0}]'}" Foreground="#888888" FontSize="11" Margin="4,0,0,0"/>
                                                <TextBlock Foreground="#00CC66" FontSize="10" Margin="6,0,0,0">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Text" Value="âœ“"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Status}" Value="Missing">
                                                                    <Setter Property="Text" Value="âœ—"/>
                                                                    <Setter Property="Foreground" Value="#FF4444"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </StackPanel>
                                        </HierarchicalDataTemplate>
                                    </TreeView.ItemTemplate>
                                </TreeView>
                            </DockPanel>
                        </TabItem>

                        <!-- Tab 2: Diagnostics -->
                        <TabItem Header="ØªØ´Ø®ÙŠØµ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡" AutomationProperties.Name="ØªØ¨ÙˆÙŠØ¨ ØªØ´Ø®ÙŠØµ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡" AutomationProperties.AutomationId="DiagnosticsTab">
                            <Grid Margin="0,10,0,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <Button Grid.Row="0" Content="Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø´Ø§Ù…Ù„" Command="{Binding AuditCommand}" 
                                        Background="#333333" Foreground="White" BorderBrush="#555555" Height="30" Margin="0,0,0,10"
                                        AutomationProperties.Name="Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø´Ø§Ù…Ù„" AutomationProperties.AutomationId="StartAudit"/>

                                <ListView Grid.Row="1" ItemsSource="{Binding AuditIssues}" Background="#252525" Foreground="White" BorderThickness="0"
                                          AutomationProperties.Name="Ù‚Ø§Ø¦Ù…Ø© Ù…Ø´ÙƒÙ„Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ" AutomationProperties.AutomationId="AuditIssuesList">
                                    <ListView.View>
                                        <GridView>
                                            <GridViewColumn Header="Ø§Ù„Ù†ÙˆØ¹" Width="80">
                                                <GridViewColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Severity}" Foreground="{Binding Severity, Converter={StaticResource SeverityColorConverter}}"/>
                                                    </DataTemplate>
                                                </GridViewColumn.CellTemplate>
                                            </GridViewColumn> 
                                            <GridViewColumn Header="Ø§Ù„Ø±Ø³Ø§Ù„Ø©" Width="300" DisplayMemberBinding="{Binding Message}"/>
                                            <GridViewColumn Header="Ø§Ù„Ù…ÙˆÙ‚Ø¹" Width="150" DisplayMemberBinding="{Binding Location}"/>
                                            <GridViewColumn Header="Ø§Ù„ÙØ¦Ø©" Width="100" DisplayMemberBinding="{Binding Category}"/>
                                        </GridView>
                                    </ListView.View>
                                </ListView>
                            </Grid>
                        </TabItem>
                    </TabControl>

                    <!-- Tools Toolbar -->
                    <Border Grid.Row="4" Background="#333333" CornerRadius="5" Padding="8,6" Margin="0,0,0,8">
                        <StackPanel>
                            <TextBlock Text="ðŸ›  Ø§Ù„Ø£Ø¯ÙˆØ§Øª" Foreground="#888888" FontSize="10" Margin="0,0,0,6"/>
                            <WrapPanel>
                                <Button Content="ðŸ” Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª" Command="{Binding PreviewDiffCommand}"
                                        Background="#2A3A4A" Foreground="#87CEEB" BorderThickness="0"
                                        Padding="10,5" Margin="0,0,6,4" FontSize="11" Cursor="Hand"
                                        AutomationProperties.AutomationId="PreviewDiffBtn"/>
                                <Button Content="ðŸ“‹ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨" Command="{Binding ManageTemplatesCommand}"
                                        Background="#2A3A4A" Foreground="#FFD700" BorderThickness="0"
                                        Padding="10,5" Margin="0,0,6,4" FontSize="11" Cursor="Hand"
                                        AutomationProperties.AutomationId="TemplatesBtn"/>
                                <Button Content="ðŸ“Š Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„ØªÙ‚Ø§Ø·Ø¹ÙŠØ©" Command="{Binding CrossReferenceMapCommand}"
                                        Background="#2A3A4A" Foreground="#00CC66" BorderThickness="0"
                                        Padding="10,5" Margin="0,0,6,4" FontSize="11" Cursor="Hand"
                                        AutomationProperties.AutomationId="CrossRefBtn"/>
                                <Button Content="âš– ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙˆØ§Ø²Ù†" Command="{Binding BalanceReportCommand}"
                                        Background="#2A3A4A" Foreground="#CC88FF" BorderThickness="0"
                                        Padding="10,5" Margin="0,0,6,4" FontSize="11" Cursor="Hand"
                                        AutomationProperties.AutomationId="BalanceBtn"/>
                                <Button Content="ðŸŽ¯ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙØµÙŠÙ„" Command="{Binding FactionConversionCommand}"
                                        Background="#2A3A4A" Foreground="#FF6B00" BorderThickness="0"
                                        Padding="10,5" Margin="0,0,6,4" FontSize="11" Cursor="Hand"
                                        AutomationProperties.AutomationId="FactionConvertBtn"/>
                            </WrapPanel>
                        </StackPanel>
                    </Border>
                    <!-- Actions -->
                    <Grid Grid.Row="5" Margin="0,10,0,0">
                        <ProgressBar Height="6" Value="{Binding ProgressValue}" Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}"
                                     Foreground="#0078D4" Background="#333333" BorderThickness="0" VerticalAlignment="Top"
                                     AutomationProperties.Name="Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ø¯Ù…" AutomationProperties.AutomationId="ProgressBar"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
                            <StackPanel Orientation="Horizontal" Margin="0,0,15,0"
                                        Visibility="{Binding HasTargetPath, Converter={StaticResource BoolToVisibility}}">
                                <TextBlock Text="ðŸ“Š" FontSize="14" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBlock Text="{Binding TargetModSlotsInfo}"
                                           Foreground="#00CC66" FontSize="11" VerticalAlignment="Center"/>
                            </StackPanel>
                            <TextBlock Text="Ø§Ù„ÙØµÙŠÙ„ Ø§Ù„Ù‡Ø¯Ù:" Foreground="#AAAAAA" FontSize="11"
                                       VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <ComboBox ItemsSource="{Binding TargetFactionOptions}"
                                      SelectedValue="{Binding SelectedTargetFaction}"
                                      SelectedValuePath="Name"
                                      Width="150" Height="28" VerticalContentAlignment="Center"
                                      Background="#333333" Foreground="White" BorderBrush="#444444" Margin="0,0,8,0"
                                      AutomationProperties.Name="ÙØµÙŠÙ„ Ø§Ù„Ù‡Ø¯Ù" AutomationProperties.AutomationId="TargetFactionSelector">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding Name}" Margin="0,0,10,0"/>
                                            <TextBlock FontSize="9">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Foreground" Value="#00CC66"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding AvailableSlots}" Value="0">
                                                                <Setter Property="Foreground" Value="#FF6666"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding TotalSlots}" Value="0">
                                                                <Setter Property="Foreground" Value="#888888"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                                <Run Text="("/>
                                                <Run Text="{Binding AvailableSlotsText, Mode=OneWay}"/>
                                                <Run Text=")"/>
                                            </TextBlock>
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                                <ComboBox.ItemContainerStyle>
                                    <Style TargetType="ComboBoxItem">
                                        <Setter Property="IsEnabled" Value="{Binding HasAvailableSlots}"/>
                                    </Style>
                                </ComboBox.ItemContainerStyle>
                            </ComboBox>
                            <Button Content="Ù†Ù‚Ù„ Ø§Ù„ÙˆØ­Ø¯Ø©" Padding="20,6" Background="#0078D4" Foreground="White" FontWeight="Bold"
                                    Command="{Binding TransferCommand}"
                                    AutomationProperties.Name="Ù†Ù‚Ù„ Ø§Ù„ÙˆØ­Ø¯Ø©" AutomationProperties.AutomationId="TransferUnitButton"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="#1E1E1E" Padding="10,4" BorderThickness="0,1,0,0" BorderBrush="#3F3F3F">
            <Grid>
                <TextBlock Text="{Binding StatusMessage}" Foreground="#888888" FontSize="10" TextTrimming="CharacterEllipsis"/>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock Foreground="#666666" FontSize="10">
                        <Run Text="Ø§Ù„ÙˆØ­Ø¯Ø§Øª: "/><Run Text="{Binding Units.Count, Mode=OneWay}" Foreground="#00CC66"/>
                        <Run Text=" | Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©: "/><Run Text="{Binding DisplayedUnits.Count, Mode=OneWay}" Foreground="#0078D4"/>
                        <Run Text=" | Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª: "/><Run Text="{Binding AnalysisCount, Mode=OneWay}" Foreground="#FF6B00"/>
                    </TextBlock>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
