<Window x:Class="ZeroHourStudio.UI.WPF.Views.CommandButtonSelectorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ðŸŽ® Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø²Ø±"
        Width="600" Height="550"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="#1E1E2E"
        Foreground="White"
        FontFamily="Segoe UI">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        
        <!-- Inverted Boolean to Visibility -->
        <Style x:Key="InvertedVisibility" TargetType="FrameworkElement">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsEmpty}" Value="False">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock Text="ðŸŽ® Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø²Ø±" FontSize="20" FontWeight="Bold" Foreground="#00CC66" Margin="0,0,0,8"/>
            <StackPanel Orientation="Horizontal" Margin="0,2,0,2">
                <TextBlock Text="Ø§Ù„ÙˆØ­Ø¯Ø©: " Foreground="#AAAAAA"/>
                <TextBlock Text="{Binding UnitName, Mode=OneWay}" Foreground="#FFD700" FontWeight="SemiBold"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,2,0,2">
                <TextBlock Text="Ø§Ù„ÙØµÙŠÙ„: " Foreground="#AAAAAA"/>
                <TextBlock Text="{Binding FactionName, Mode=OneWay}" Foreground="#87CEEB"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,2,0,2">
                <TextBlock Text="CommandSet: " Foreground="#AAAAAA"/>
                <TextBlock Text="{Binding CommandSetName, Mode=OneWay}" Foreground="#CCCCCC"/>
            </StackPanel>
        </StackPanel>

        <Separator Grid.Row="1" Background="#333348" Margin="0,0,0,10"/>

        <!-- Slots Grid (3x4) -->
        <ItemsControl Grid.Row="2" ItemsSource="{Binding Buttons}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid Rows="3" Columns="4"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>

            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Button Margin="4" Padding="6"
                            MinHeight="60"
                            Click="SlotButton_Click"
                            Tag="{Binding}"
                            Cursor="Hand"
                            BorderThickness="2">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="#2A2A3A"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="BorderBrush" Value="#444466"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="border" 
                                                    Background="{TemplateBinding Background}" 
                                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    CornerRadius="6" Padding="{TemplateBinding Padding}">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="BorderBrush" Value="#FFD700"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <!-- ÙØ§Ø±Øº = Ø£Ø®Ø¶Ø± -->
                                    <DataTrigger Binding="{Binding IsEmpty}" Value="True">
                                        <Setter Property="Background" Value="#1A3A2A"/>
                                        <Setter Property="BorderBrush" Value="#00CC66"/>
                                    </DataTrigger>
                                    <!-- Ù…Ø´ØºÙˆÙ„ = Ø£Ø­Ù…Ø± -->
                                    <DataTrigger Binding="{Binding IsEmpty}" Value="False">
                                        <Setter Property="Background" Value="#3A1A1A"/>
                                        <Setter Property="BorderBrush" Value="#FF6666"/>
                                    </DataTrigger>
                                    <!-- Ù…Ø­Ø¯Ø¯ = Ø°Ù‡Ø¨ÙŠ -->
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="BorderBrush" Value="#FFD700"/>
                                        <Setter Property="BorderThickness" Value="3"/>
                                        <Setter Property="Background" Value="#2A2A00"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>

                        <Button.ToolTip>
                            <StackPanel>
                                <TextBlock Text="{Binding OccupiedBy}" FontWeight="Bold"/>
                                <TextBlock Text="{Binding Command}" Foreground="Gray" FontSize="10"/>
                                <TextBlock Text="{Binding ButtonImageName}" Foreground="Gray" FontSize="9"/>
                            </StackPanel>
                        </Button.ToolTip>

                        <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¹Ù„Ø§Ø¦Ù‚ÙŠ -->
                            <Image Grid.Row="0" Source="{Binding IconSource}"
                                   Width="36" Height="36" Stretch="Uniform"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                   RenderOptions.BitmapScalingMode="NearestNeighbor"
                                   Visibility="{Binding HasIcon, Converter={StaticResource BoolToVis}}"/>

                            <!-- ÙÙˆÙ„Ø¨Ø§Ùƒ: Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø£ÙˆÙ„ Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ØªÙˆÙØ± Ø£ÙŠÙ‚ÙˆÙ†Ø© -->
                            <Border Grid.Row="0" Width="36" Height="36"
                                    CornerRadius="4" HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Setter Property="Background" Value="#444460"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding HasIcon}" Value="False">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding IsEmpty}" Value="True">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <TextBlock Text="{Binding OccupiedBy, FallbackValue='?'}"
                                           FontSize="16" FontWeight="Bold"
                                           Foreground="#AAAACC"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"
                                           TextTrimming="CharacterEllipsis"
                                           MaxWidth="30"/>
                            </Border>

                            <!-- Ø±Ù‚Ù… Ø§Ù„Ø²Ø± + Ø§Ø³Ù… -->
                            <StackPanel Grid.Row="1" HorizontalAlignment="Center" Margin="0,2,0,0">
                                <TextBlock Text="{Binding SlotNumber, StringFormat='#{0}'}"
                                           FontSize="10" FontWeight="SemiBold"
                                           HorizontalAlignment="Center"
                                           Foreground="#AAAAAA"/>
                                <TextBlock HorizontalAlignment="Center" FontSize="8"
                                           TextTrimming="CharacterEllipsis" MaxWidth="90"
                                           TextAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="{Binding OccupiedBy}"/>
                                            <Setter Property="Foreground" Value="#FF9999"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsEmpty}" Value="True">
                                                    <Setter Property="Text" Value="ÙØ§Ø±Øº âœ“"/>
                                                    <Setter Property="Foreground" Value="#00CC66"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </Grid>
                    </Button>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Warning: No empty slots -->
        <Border Grid.Row="3" Background="#3A2A1A" BorderBrush="#FF6B00" BorderThickness="1"
                CornerRadius="6" Padding="12" Margin="0,8,0,8"
                Visibility="{Binding NoEmptySlot, Converter={StaticResource BoolToVis}}">
            <StackPanel>
                <TextBlock Text="âš  Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ù…Ø§ÙƒÙ† ÙØ§Ø±ØºØ©!" Foreground="#FF6B00" FontWeight="Bold" FontSize="13" Margin="0,0,0,4"/>
                <TextBlock Text="Ø§Ø®ØªØ± Ø²Ø± Ù…ÙˆØ¬ÙˆØ¯ Ù…Ù† Ø§Ù„Ø´Ø¨ÙƒØ© Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¨Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" Foreground="#CCAA88" FontSize="11"/>
            </StackPanel>
        </Border>

        <!-- Buttons -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
            <Button Content="Ø¥Ù„ØºØ§Ø¡" Click="Cancel_Click" Width="100" Height="34"
                    Background="#3A3A4A" Foreground="White" BorderBrush="#555577" BorderThickness="1"
                    Margin="0,0,8,0" Cursor="Hand">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="6" Padding="8,4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Button.Template>
            </Button>
            <Button x:Name="ConfirmButton" Content="âœ“ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±" Click="Confirm_Click"
                    Width="150" Height="34"
                    IsEnabled="{Binding HasSelection, Mode=OneWay}"
                    Background="#00884C" Foreground="White" BorderBrush="#00CC66" BorderThickness="1"
                    FontWeight="Bold" Cursor="Hand">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="confirmBorder"
                                Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="6" Padding="8,4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="confirmBorder" Property="Background" Value="#333344"/>
                                <Setter TargetName="confirmBorder" Property="BorderBrush" Value="#555566"/>
                                <Setter Property="Foreground" Value="#666666"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Button.Template>
            </Button>
        </StackPanel>
    </Grid>
</Window>
