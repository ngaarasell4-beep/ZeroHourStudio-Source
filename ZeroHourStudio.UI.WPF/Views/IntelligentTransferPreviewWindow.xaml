<Window x:Class="ZeroHourStudio.UI.WPF.Views.IntelligentTransferPreviewWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:ZeroHourStudio.UI.WPF"
        Title="ðŸ§  Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø°ÙƒÙŠØ©" Height="720" Width="850"
        Background="#0D1117" WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize" FontFamily="Segoe UI">

    <Window.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Grid>
        <!-- Ø®Ù„ÙÙŠØ© Ù…ØªØ¯Ø±Ø¬Ø© -->
        <Border>
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#0D1117" Offset="0"/>
                    <GradientStop Color="#161B22" Offset="0.5"/>
                    <GradientStop Color="#0D1117" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
        </Border>

        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- === Ø§Ù„Ø±Ø£Ø³: Ø§Ù„Ø¹Ù†ÙˆØ§Ù† + Ù†Ø³Ø¨Ø© Ø§Ù„ØµØ­Ø© === -->
            <Border Grid.Row="0" CornerRadius="12" Padding="20" Margin="0,0,0,12">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                        <GradientStop Color="#161B22" Offset="0"/>
                        <GradientStop Color="#1A2332" Offset="1"/>
                    </LinearGradientBrush>
                </Border.Background>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø© -->
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="ðŸ§  Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ù„Ù„Ù†Ù‚Ù„" FontSize="18" FontWeight="Bold" Foreground="#E8EDF3" Margin="0,0,0,8"/>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding UnitName}" FontSize="14" Foreground="#00D4FF" FontWeight="SemiBold"/>
                            <TextBlock Text=" â† " Foreground="#556677" FontSize="14"/>
                            <TextBlock Text="{Binding SourceFaction}" Foreground="#FF6B00" FontSize="14"/>
                            <TextBlock Text=" â†’ " Foreground="#556677" FontSize="14"/>
                            <TextBlock Text="{Binding TargetFaction}" Foreground="#00FF88" FontSize="14"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                            <TextBlock Text="{Binding DependencyCount}" Foreground="#FFD700" FontSize="12"/>
                            <TextBlock Text=" ØªØ¨Ø¹ÙŠØ© | " Foreground="#556677" FontSize="12"/>
                            <TextBlock Text="{Binding TargetModName}" Foreground="#888" FontSize="12"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Ù†Ø³Ø¨Ø© Ø§Ù„ØµØ­Ø© -->
                    <Border Grid.Column="1" Width="90" Height="90" CornerRadius="45" BorderThickness="4"
                            HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Border.BorderBrush>
                            <SolidColorBrush Color="{Binding HealthColor}"/>
                        </Border.BorderBrush>
                        <Border.Background>
                            <SolidColorBrush Color="#0D1117" Opacity="0.8"/>
                        </Border.Background>
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <TextBlock HorizontalAlignment="Center" FontSize="24" FontWeight="Bold">
                                <TextBlock.Foreground>
                                    <SolidColorBrush Color="{Binding HealthColor}"/>
                                </TextBlock.Foreground>
                                <Run Text="{Binding HealthScore, Mode=OneWay}"/><Run Text="%"/>
                            </TextBlock>
                            <TextBlock Text="{Binding HealthGrade}" HorizontalAlignment="Center"
                                       FontSize="10" Foreground="#888"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- === Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ === -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="0,0,8,0">
                <StackPanel>

                    <!-- ===== Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ø®Øµ ===== -->
                    <Border Background="#161B22" CornerRadius="10" Padding="14" Margin="0,0,0,10"
                            BorderBrush="#30363D" BorderThickness="1">
                        <TextBlock Text="{Binding OverallSummary}" Foreground="#C9D1D9"
                                   TextWrapping="Wrap" FontSize="12"/>
                    </Border>

                    <!-- ===== Ù‚Ø³Ù… Ø§Ù„ØªØ´Ø®ÙŠØµØ§Øª ===== -->
                    <Border CornerRadius="10" Padding="14" Margin="0,0,0,10"
                            Visibility="{Binding HasDiagnoses, Converter={StaticResource BoolToVis}}"
                            BorderBrush="#FF6B00" BorderThickness="1">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                <GradientStop Color="#1A1510" Offset="0"/>
                                <GradientStop Color="#161B22" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <TextBlock Text="ðŸ” ØªØ´Ø®ÙŠØµ Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª" FontSize="14" FontWeight="Bold" Foreground="#FF6B00"/>
                                <Border Background="#2D1A0D" CornerRadius="8" Padding="6,2" Margin="10,0,0,0">
                                    <TextBlock FontSize="10" Foreground="#FFB366">
                                        <Run Text="{Binding DiagnosesCount, Mode=OneWay}"/><Run Text=" ØªØ¹Ø§Ø±Ø¶ | "/>
                                        <Run Text="{Binding AutoFixableCount, Mode=OneWay}"/><Run Text=" Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø­Ù„ Ø§Ù„Ø¢Ù„ÙŠ"/>
                                    </TextBlock>
                                </Border>
                            </StackPanel>

                            <ItemsControl ItemsSource="{Binding Diagnoses}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#0D1117" CornerRadius="8" Padding="12" Margin="0,0,0,6"
                                                BorderBrush="#21262D" BorderThickness="1">
                                            <StackPanel>
                                                <!-- Ø§Ù„Ø§Ø³Ù… + Ø§Ù„Ø®Ø·ÙˆØ±Ø© -->
                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                                    <TextBlock Text="{Binding SeverityIcon}" FontSize="14" Margin="0,0,6,0"/>
                                                    <TextBlock Text="{Binding DefinitionName}" FontSize="13"
                                                               Foreground="#E8EDF3" FontWeight="SemiBold"/>
                                                    <Border Background="#1A2332" CornerRadius="4" Padding="5,1" Margin="8,0,0,0">
                                                        <TextBlock Text="{Binding DefinitionType}" FontSize="9" Foreground="#556677"/>
                                                    </Border>
                                                    <Border CornerRadius="4" Padding="5,1" Margin="4,0,0,0">
                                                        <Border.Background>
                                                            <SolidColorBrush Color="{Binding SeverityIcon}" Opacity="0.15"/>
                                                        </Border.Background>
                                                        <TextBlock Text="{Binding SeverityText}" FontSize="9" Foreground="#FFB366"/>
                                                    </Border>
                                                </StackPanel>

                                                <!-- Ø§Ù„Ø³Ø¨Ø¨ -->
                                                <StackPanel Margin="22,0,0,4">
                                                    <TextBlock Foreground="#556677" FontSize="10" Text="Ø§Ù„Ø³Ø¨Ø¨:" Margin="0,0,0,2"/>
                                                    <TextBlock Text="{Binding RootCause}" Foreground="#C9D1D9"
                                                               TextWrapping="Wrap" FontSize="11"/>
                                                </StackPanel>

                                                <!-- Ø§Ù„Ø´Ø±Ø­ -->
                                                <StackPanel Margin="22,0,0,4">
                                                    <TextBlock Foreground="#556677" FontSize="10" Text="Ø§Ù„ØªØ£Ø«ÙŠØ±:" Margin="0,0,0,2"/>
                                                    <TextBlock Text="{Binding Explanation}" Foreground="#A0AAB8"
                                                               TextWrapping="Wrap" FontSize="11"/>
                                                </StackPanel>

                                                <!-- Ø§Ù„Ø­Ù„ÙˆÙ„ -->
                                                <Border Background="#0A0E14" CornerRadius="6" Padding="8" Margin="22,4,0,0">
                                                    <StackPanel>
                                                        <TextBlock Text="ðŸ’¡ Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø­Ø©:" Foreground="#00D4FF"
                                                                   FontSize="10" Margin="0,0,0,4"/>
                                                        <ItemsControl ItemsSource="{Binding Solutions}">
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <StackPanel Orientation="Horizontal" Margin="0,2">
                                                                        <TextBlock FontSize="10" Foreground="#556677" Margin="0,0,4,0">
                                                                            <Run Text="#"/><Run Text="{Binding Priority, Mode=OneWay}"/>
                                                                        </TextBlock>
                                                                        <TextBlock Text="{Binding Title}" FontSize="11"
                                                                                   Foreground="#00FF88" FontWeight="SemiBold"
                                                                                   Margin="0,0,6,0"/>
                                                                        <TextBlock Text="{Binding Description}" FontSize="10"
                                                                                   Foreground="#888" TextWrapping="Wrap"/>
                                                                    </StackPanel>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- ===== Ù‚Ø³Ù… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„ÙŠØ¯ÙˆÙŠØ© Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø© ===== -->
                    <Border CornerRadius="10" Padding="14" Margin="0,0,0,10"
                            Visibility="{Binding HasManualEdits, Converter={StaticResource BoolToVis}}"
                            BorderBrush="#00D4FF" BorderThickness="1">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                <GradientStop Color="#0D1520" Offset="0"/>
                                <GradientStop Color="#161B22" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <TextBlock Text="âš¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„ÙŠØ¯ÙˆÙŠØ©" FontSize="14" FontWeight="Bold" Foreground="#00D4FF"/>
                                <Border Background="#0D2240" CornerRadius="8" Padding="6,2" Margin="10,0,0,0">
                                    <TextBlock FontSize="10" Foreground="#66B3FF">
                                        <Run Text="{Binding ManualEditsResolved, Mode=OneWay}"/><Run Text=" Ù…Ø­Ù„ÙˆÙ„ | "/>
                                        <Run Text="{Binding ManualEditsPending, Mode=OneWay}"/><Run Text=" Ù…Ø¹Ù„Ù‘Ù‚"/>
                                    </TextBlock>
                                </Border>
                            </StackPanel>

                            <ItemsControl ItemsSource="{Binding ManualEdits}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border CornerRadius="6" Padding="10" Margin="0,0,0,4"
                                                BorderBrush="#21262D" BorderThickness="1">
                                            <Border.Background>
                                                <SolidColorBrush Color="#0D1117"/>
                                            </Border.Background>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="{Binding StatusIcon}" FontSize="16"
                                                           VerticalAlignment="Top" Margin="0,0,10,0"/>
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="{Binding Description}" Foreground="#E8EDF3"
                                                               FontSize="12" TextWrapping="Wrap"/>
                                                    <TextBlock Text="{Binding AppliedFix}" Foreground="#888"
                                                               FontSize="10" TextWrapping="Wrap" Margin="0,4,0,0"/>
                                                    <TextBlock Text="{Binding StatusMessage}" FontSize="10"
                                                               Foreground="#00FF88" Margin="0,4,0,0"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- ===== Ù‚Ø³Ù… Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„ØµØ­ÙŠØ© ===== -->
                    <Border Background="#161B22" CornerRadius="10" Padding="14" Margin="0,0,0,10"
                            BorderBrush="#30363D" BorderThickness="1">
                        <StackPanel>
                            <TextBlock Text="ðŸ©º ÙØ­ÙˆØµØ§Øª Ø§Ù„ØµØ­Ø©" FontSize="14" FontWeight="Bold"
                                       Foreground="#E8EDF3" Margin="0,0,0,10"/>
                            <ItemsControl ItemsSource="{Binding HealthChecks}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="8,6" Margin="0,0,0,3"
                                                Background="#0D1117" CornerRadius="5">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" FontSize="12" Margin="0,0,8,0"
                                                           VerticalAlignment="Center">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Text" Value="âŒ"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Passed}" Value="True">
                                                                    <Setter Property="Text" Value="âœ…"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="{Binding Name}" Foreground="#E8EDF3" FontSize="11"/>
                                                    <TextBlock Text="{Binding Details}" Foreground="#556677" FontSize="9"
                                                               TextWrapping="Wrap"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- ===== Ù‚Ø³Ù… Ø§Ù„Ù…Ø®Ø§Ø·Ø± ===== -->
                    <Border CornerRadius="10" Padding="14" Margin="0,0,0,10"
                            Visibility="{Binding HasRisks, Converter={StaticResource BoolToVis}}"
                            BorderBrush="#FF3366" BorderThickness="1">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                <GradientStop Color="#1A0D15" Offset="0"/>
                                <GradientStop Color="#161B22" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <StackPanel>
                            <TextBlock Text="âš  Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©" FontSize="14" FontWeight="Bold"
                                       Foreground="#FF3366" Margin="0,0,0,10"/>
                            <ItemsControl ItemsSource="{Binding Risks}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#0D1117" CornerRadius="6" Padding="10" Margin="0,0,0,4">
                                            <StackPanel>
                                                <TextBlock Text="{Binding Description}" Foreground="#FFB3C6"
                                                           FontSize="11" TextWrapping="Wrap"/>
                                                <TextBlock FontSize="10" Foreground="#556677" Margin="0,4,0,0"
                                                           TextWrapping="Wrap">
                                                    <Run Text="Ø§Ù„ØªØ®ÙÙŠÙ: "/><Run Text="{Binding Mitigation, Mode=OneWay}" Foreground="#888"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- ===== Ù‚Ø³Ù… Ø§Ù„ØªÙˆØµÙŠØ§Øª ===== -->
                    <Border Background="#161B22" CornerRadius="10" Padding="14" Margin="0,0,0,10"
                            Visibility="{Binding HasRecommendations, Converter={StaticResource BoolToVis}}"
                            BorderBrush="#30363D" BorderThickness="1">
                        <StackPanel>
                            <TextBlock Text="ðŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª" FontSize="14" FontWeight="Bold"
                                       Foreground="#FFD700" Margin="0,0,0,10"/>
                            <ItemsControl ItemsSource="{Binding Recommendations}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" Foreground="#C9D1D9"
                                                   FontSize="11" TextWrapping="Wrap" Margin="0,0,0,4"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                </StackPanel>
            </ScrollViewer>

            <!-- === Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… === -->
            <Border Grid.Row="2" Margin="0,12,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Ø²Ø± Ø­Ù„ Ø§Ù„ÙƒÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
                    <Button Grid.Column="0" Content="âš¡ Ø­Ù„ Ø§Ù„ÙƒÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" Padding="16,10"
                            Background="#1A2332" Foreground="#00D4FF" FontWeight="Bold"
                            BorderBrush="#00D4FF" BorderThickness="1" Cursor="Hand" FontSize="12"
                            Click="AutoResolveAll_Click"
                            Visibility="{Binding CanAutoResolveAll, Converter={StaticResource BoolToVis}}"/>

                    <!-- Ø£Ø²Ø±Ø§Ø± Ø¥Ù„ØºØ§Ø¡ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <Button Content="Ø¥Ù„ØºØ§Ø¡" Padding="20,10" Margin="0,0,8,0"
                                Background="#21262D" Foreground="#C9D1D9"
                                BorderBrush="#30363D" BorderThickness="1" Cursor="Hand" FontSize="12"
                                Click="Cancel_Click"/>
                        <Button Padding="24,10" FontWeight="Bold" BorderThickness="0"
                                Cursor="Hand" FontSize="12" Click="Proceed_Click">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Content" Value="âœ“ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù†Ù‚Ù„"/>
                                    <Setter Property="Background" Value="#00D4FF"/>
                                    <Setter Property="Foreground" Value="#0A0E17"/>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>
